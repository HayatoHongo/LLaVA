digraph G {
    graph [rankdir=TB];
    subgraph cluster_G {

        graph [style="filled,rounded",fillcolor="#80808018", label=""];
        llama_flash_attn_monkey_patch [label="llama_flash_attn_monkey_patch", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="0"];
        llama_xformers_attn_monkey_patch [label="llama_xformers_attn_monkey_patch", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="1"];
        llava_trainer [label="llava_trainer", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        train [label="train", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train_mem [label="train_mem", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="4"];
        train_xformers [label="train_xformers", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="5"];
        llama_flash_attn_monkey_patch___prepare_decoder_attention_mask [label="_prepare_decoder_attention_mask", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="0"];
        llama_flash_attn_monkey_patch__forward [label="forward", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="0"];
        llama_flash_attn_monkey_patch__replace_llama_attn_with_flash_attn [label="replace_llama_attn_with_flash_attn", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="0"];
        llama_xformers_attn_monkey_patch__replace_llama_attn_with_xformers_attn [label="replace_llama_attn_with_xformers_attn", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="1"];
        llama_xformers_attn_monkey_patch__xformers_forward [label="xformers_forward", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="1"];
        llava_trainer__LLaVATrainer [label="LLaVATrainer", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        llava_trainer__LengthGroupedSampler [label="LengthGroupedSampler", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        llava_trainer__get_length_grouped_indices [label="get_length_grouped_indices", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        llava_trainer__get_mm_adapter_state_maybe_zero_3 [label="get_mm_adapter_state_maybe_zero_3", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        llava_trainer__get_modality_length_grouped_indices [label="get_modality_length_grouped_indices", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        llava_trainer__maybe_zero_3 [label="maybe_zero_3", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        llava_trainer__split_to_even_chunks [label="split_to_even_chunks", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        llava_trainer__LLaVATrainer___get_train_sampler [label="_get_train_sampler", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        llava_trainer__LLaVATrainer___save [label="_save", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        llava_trainer__LLaVATrainer___save_checkpoint [label="_save_checkpoint", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        llava_trainer__LLaVATrainer__create_optimizer [label="create_optimizer", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        llava_trainer__LengthGroupedSampler____init__ [label="__init__", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        llava_trainer__LengthGroupedSampler____iter__ [label="__iter__", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        llava_trainer__LengthGroupedSampler____len__ [label="__len__", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="2"];
        train__DataArguments [label="DataArguments", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__DataCollatorForSupervisedDataset [label="DataCollatorForSupervisedDataset", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__LazySupervisedDataset [label="LazySupervisedDataset", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__ModelArguments [label="ModelArguments", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__TrainingArguments [label="TrainingArguments", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train___add_speaker_and_signal [label="_add_speaker_and_signal", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train___mask_targets [label="_mask_targets", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train___tokenize_fn [label="_tokenize_fn", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__find_all_linear_names [label="find_all_linear_names", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__get_mm_adapter_state_maybe_zero_3 [label="get_mm_adapter_state_maybe_zero_3", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__get_peft_state_maybe_zero_3 [label="get_peft_state_maybe_zero_3", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__get_peft_state_non_lora_maybe_zero_3 [label="get_peft_state_non_lora_maybe_zero_3", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__make_supervised_data_module [label="make_supervised_data_module", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__maybe_zero_3 [label="maybe_zero_3", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__preprocess [label="preprocess", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__preprocess_llama_2 [label="preprocess_llama_2", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__preprocess_mpt [label="preprocess_mpt", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__preprocess_multimodal [label="preprocess_multimodal", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__preprocess_plain [label="preprocess_plain", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__preprocess_v1 [label="preprocess_v1", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__rank0_print [label="rank0_print", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__safe_save_model_for_hf_trainer [label="safe_save_model_for_hf_trainer", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__smart_tokenizer_and_embedding_resize [label="smart_tokenizer_and_embedding_resize", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__train [label="train", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__DataCollatorForSupervisedDataset____call__ [label="__call__", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__LazySupervisedDataset____getitem__ [label="__getitem__", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__LazySupervisedDataset____init__ [label="__init__", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__LazySupervisedDataset____len__ [label="__len__", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__LazySupervisedDataset__lengths [label="lengths", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__LazySupervisedDataset__modality_lengths [label="modality_lengths", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__LazySupervisedDataset____getitem____expand2square [label="expand2square", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__preprocess__get_tokenize_len [label="get_tokenize_len", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
        train__train__make_inputs_require_grad [label="make_inputs_require_grad", style="filled", fillcolor="#ffffffb2", fontcolor="#000000", group="3"];
    }
        llama_flash_attn_monkey_patch__replace_llama_attn_with_flash_attn -> llama_flash_attn_monkey_patch___prepare_decoder_attention_mask [style="solid", color="#000000"];
        llama_flash_attn_monkey_patch__replace_llama_attn_with_flash_attn -> llama_flash_attn_monkey_patch__forward [style="solid", color="#000000"];
        llama_xformers_attn_monkey_patch__replace_llama_attn_with_xformers_attn -> llama_xformers_attn_monkey_patch__xformers_forward [style="solid", color="#000000"];
        llava_trainer__get_mm_adapter_state_maybe_zero_3 -> llava_trainer__maybe_zero_3 [style="solid", color="#000000"];
        llava_trainer__get_modality_length_grouped_indices -> llava_trainer__get_length_grouped_indices [style="solid", color="#000000"];
        llava_trainer__get_length_grouped_indices -> llava_trainer__split_to_even_chunks [style="solid", color="#000000"];
        llava_trainer__LengthGroupedSampler____iter__ -> llava_trainer__get_modality_length_grouped_indices [style="solid", color="#000000"];
        llava_trainer__LengthGroupedSampler____iter__ -> llava_trainer__get_length_grouped_indices [style="solid", color="#000000"];
        llava_trainer__LLaVATrainer___get_train_sampler -> llava_trainer__LengthGroupedSampler____init__ [style="solid", color="#000000"];
        llava_trainer__LLaVATrainer___get_train_sampler -> llava_trainer__LengthGroupedSampler [style="solid", color="#000000"];
        llava_trainer__LLaVATrainer___save_checkpoint -> llava_trainer__get_mm_adapter_state_maybe_zero_3 [style="solid", color="#000000"];
        train -> train__train [style="solid", color="#000000"];
        train__get_peft_state_maybe_zero_3 -> train__maybe_zero_3 [style="solid", color="#000000"];
        train__get_peft_state_non_lora_maybe_zero_3 -> train__maybe_zero_3 [style="solid", color="#000000"];
        train__get_mm_adapter_state_maybe_zero_3 -> train__maybe_zero_3 [style="solid", color="#000000"];
        train__safe_save_model_for_hf_trainer -> train__get_mm_adapter_state_maybe_zero_3 [style="solid", color="#000000"];
        train__preprocess -> train__preprocess_v1 [style="solid", color="#000000"];
        train__preprocess -> train___add_speaker_and_signal [style="solid", color="#000000"];
        train__preprocess -> train__preprocess__get_tokenize_len [style="solid", color="#000000"];
        train__preprocess -> train___tokenize_fn [style="solid", color="#000000"];
        train__preprocess -> train__preprocess_plain [style="solid", color="#000000"];
        train__preprocess -> train__preprocess_mpt [style="solid", color="#000000"];
        train__preprocess -> train___mask_targets [style="solid", color="#000000"];
        train__preprocess -> train__preprocess_llama_2 [style="solid", color="#000000"];
        train__LazySupervisedDataset____init__ -> train__rank0_print [style="solid", color="#000000"];
        train__LazySupervisedDataset____getitem__ -> train__preprocess_multimodal [style="solid", color="#000000"];
        train__LazySupervisedDataset____getitem__ -> train__preprocess [style="solid", color="#000000"];
        train__LazySupervisedDataset____getitem__ -> train__LazySupervisedDataset____getitem____expand2square [style="solid", color="#000000"];
        train__make_supervised_data_module -> train__LazySupervisedDataset____init__ [style="solid", color="#000000"];
        train__make_supervised_data_module -> train__LazySupervisedDataset [style="solid", color="#000000"];
        train__make_supervised_data_module -> train__DataCollatorForSupervisedDataset [style="solid", color="#000000"];
        train__train -> train__train__make_inputs_require_grad [style="solid", color="#000000"];
        train__train -> train__ModelArguments [style="solid", color="#000000"];
        train__train -> train__get_peft_state_maybe_zero_3 [style="solid", color="#000000"];
        train__train -> train__DataArguments [style="solid", color="#000000"];
        train__train -> train__safe_save_model_for_hf_trainer [style="solid", color="#000000"];
        train__train -> train__find_all_linear_names [style="solid", color="#000000"];
        train__train -> train__get_peft_state_non_lora_maybe_zero_3 [style="solid", color="#000000"];
        train__train -> train__smart_tokenizer_and_embedding_resize [style="solid", color="#000000"];
        train__train -> train__rank0_print [style="solid", color="#000000"];
        train__train -> train__TrainingArguments [style="solid", color="#000000"];
        train__train -> train__make_supervised_data_module [style="solid", color="#000000"];
    }
